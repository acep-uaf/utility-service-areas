<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>About – Service area explorer</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cd884f2855776405ca61470c593c983e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Service area explorer</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./about.html" aria-current="page"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#about-this-project" id="toc-about-this-project" class="nav-link active" data-scroll-target="#about-this-project">About this project</a></li>
  <li><a href="#download-the-data" id="toc-download-the-data" class="nav-link" data-scroll-target="#download-the-data">Download the data</a></li>
  <li><a href="#github-repository" id="toc-github-repository" class="nav-link" data-scroll-target="#github-repository">GitHub repository</a></li>
  <li><a href="#metadata" id="toc-metadata" class="nav-link" data-scroll-target="#metadata">Metadata</a>
  <ul class="collapse">
  <li><a href="#description-of-fields" id="toc-description-of-fields" class="nav-link" data-scroll-target="#description-of-fields">Description of fields</a></li>
  </ul></li>
  <li><a href="#data-pipeline-details" id="toc-data-pipeline-details" class="nav-link" data-scroll-target="#data-pipeline-details">Data pipeline details</a>
  <ul class="collapse">
  <li><a href="#how-the-pipeline-works" id="toc-how-the-pipeline-works" class="nav-link" data-scroll-target="#how-the-pipeline-works">How the pipeline works</a></li>
  <li><a href="#manual-patches" id="toc-manual-patches" class="nav-link" data-scroll-target="#manual-patches">Manual patches</a>
  <ul class="collapse">
  <li><a href="#excluded-certificates" id="toc-excluded-certificates" class="nav-link" data-scroll-target="#excluded-certificates">Excluded certificates</a></li>
  </ul></li>
  <li><a href="#other-fixes" id="toc-other-fixes" class="nav-link" data-scroll-target="#other-fixes">Other fixes</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">About</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="about-this-project" class="level1">
<h1>About this project</h1>
<p>This site allows users to view and download the authorized service areas of utilities certificated by the Regulatory Commission of Alaska (RCA). The RCA sets and approves the areas in which utilities may operate, and provides this information on a per-utility basis through their website. These boundaries are invaluable for researchers who are studying energy rates in communities across Alaska, especially since the majority of Alaskans are served by microgrid systems which are not interconnected to a broader traditional power grid.</p>
<p>The goal of this project is to create a single geospatial layer containing the service area boundaries of every active electric utility in Alaska.</p>
<ul>
<li>The State of Alaska <a href="https://dcra-cdo-dcced.opendata.arcgis.com/search?q=rca">Division of Community and Regional Affairs</a> (DCRA) also provides service area layers for electric, water, sewer, and natural gas utilities certificated by the RCA. For more information, visit the DCRA open data portal at <a href="https://dcra-cdo-dcced.opendata.arcgis.com/search?q=rca" class="uri">https://dcra-cdo-dcced.opendata.arcgis.com/search?q=rca</a></li>
</ul>
<p>Note: before using this data in your project, please read this entire page to learn more about how this dataset was assembled. Because of source data quality issues, this dataset does not contain every utility’s service area, and if it does, it might not be up-to-date.</p>
</section>
<section id="download-the-data" class="level1">
<h1>Download the data</h1>
<p>Download the latest version of the GeoJSON file: <a href="./service-areas-v2-metadata.geojson" target="_blank" download="">Download now</a></p>
</section>
<section id="github-repository" class="level1">
<h1>GitHub repository</h1>
<p>Access the GitHub repository here: https://github.com/acep-uaf/utility-service-areas</p>
</section>
<section id="metadata" class="level1">
<h1>Metadata</h1>
<section id="description-of-fields" class="level2">
<h2 class="anchored" data-anchor-id="description-of-fields">Description of fields</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>certificate_number</code></td>
<td>number</td>
<td>Official numeric ID for the utility’s certificate.</td>
</tr>
<tr class="even">
<td><code>entity</code></td>
<td>string</td>
<td>A short name or acronym for the utility (e.g., “AEL&amp;P”). Useful for grouping or labeling.</td>
</tr>
<tr class="odd">
<td><code>certificate_name</code></td>
<td>string</td>
<td>Full name of the certificate holder as recorded by the Regulatory Commission of Alaska.</td>
</tr>
<tr class="even">
<td><code>certificate_url</code></td>
<td>string (URL)</td>
<td>Direct link to the certificate detail page on the Alaska RCA website.</td>
</tr>
<tr class="odd">
<td><code>certificate_granted_year</code></td>
<td>number</td>
<td>Year the certificate was originally granted. Useful for historical context.</td>
</tr>
<tr class="even">
<td><code>certificate_last_update_date</code></td>
<td>string (YYYY-MM-DD)</td>
<td>Date of the most recent change to the certificate listed in the certificate chronology. May or may not be a change that affected the service area.</td>
</tr>
<tr class="odd">
<td><code>certificate_last_update_order</code></td>
<td>string</td>
<td>RCA docket and order number for the last update.</td>
</tr>
<tr class="even">
<td><code>certificate_last_update_type</code></td>
<td>string</td>
<td>Description of the most recent update (e.g., <code>"Service Area Expansion"</code>, <code>"Transfer"</code>).</td>
</tr>
<tr class="odd">
<td><code>geometry_last_update</code></td>
<td>string (YYYY-MM-DD)</td>
<td>Date the service area polygon reflects — e.g.&nbsp;the date of the latest included certificate action.</td>
</tr>
<tr class="even">
<td><code>geometry_is_current</code></td>
<td>boolean</td>
<td><code>true</code> if the geometry reflects the latest known certificate update (if <code>certificate_last_update_date</code> is equal to <code>geometry_last_update</code>); <code>false</code> otherwise.</td>
</tr>
<tr class="odd">
<td><code>geometry_cert_sync_status</code></td>
<td>string</td>
<td>One of: <code>"up_to_date"</code>, <code>"outdated"</code>, or <code>"unknown"</code>. Indicates whether the polygon is current.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="data-pipeline-details" class="level1">
<h1>Data pipeline details</h1>
<section id="how-the-pipeline-works" class="level2">
<h2 class="anchored" data-anchor-id="how-the-pipeline-works">How the pipeline works</h2>
<p>This repository uses a data pipeline written using the targets R package. The pipeline consists of the following components:</p>
<ol type="1">
<li>A list of active electric certificates is retrieved from the RCA website. For each certificate, the provided service area KML file is downloaded.
<ul>
<li>Note: not all electric certificates on the RCA website have service area KML files available for download, which poses issues.</li>
</ul></li>
<li>Certificates that do not have service areas or do not serve consumers - such as wholesale or independent power producers - are filtered out. Identified errors in the source data, such as inactive utilities still marked as active, are also removed. (see <strong>Manual Patches</strong> below).</li>
<li>Additional data quality issues are manually corrected (see <strong>Manual Patches</strong> below).</li>
<li>The service areas are combined into a single layer and exported to GeoJSON format with appropriate metadata.</li>
</ol>
<p>As mentioned above, <u>not all electric certificates on the RCA website have service area KML files available for download. Additionally, some of the KML files that were available for download were out of date or did not accurately reflect the service area description.</u> Unfortunately, there is no automated, one-size-fits-all solution for a dataset like this, but when possible, data issues were fixed (“patched”) on a case-by-case basis and the fixes integrated into the data pipeline.</p>
</section>
<section id="manual-patches" class="level2">
<h2 class="anchored" data-anchor-id="manual-patches">Manual patches</h2>
<section id="excluded-certificates" class="level3">
<h3 class="anchored" data-anchor-id="excluded-certificates">Excluded certificates</h3>
<p>The following certificates are not included in the dataset because they were determined to be independent power producers, wholesale sellers, or some other unique case of electric utility that a) doesn’t directly provide power to consumers b) does not have a service area. For more details on each of these excluded certificates, please refer to the comments <a href="https://github.com/acep-uaf/utility-service-areas/blob/main/_targets.R#L67-L139">here</a>.</p>
<ul>
<li><p>Gustavus Utility Service, Inc.</p></li>
<li><p>Alaska Industrial Development &amp; Export Authority - Snettisham</p></li>
<li><p>BBL Hydro, Inc.</p></li>
<li><p>Municipality of Anchorage d/b/a Anchorage Hydropower</p></li>
<li><p>Alaska Electric and Energy Cooperative, Inc.</p></li>
<li><p>TDX St.&nbsp;Paul Wind, LLC</p></li>
<li><p>Goat Lake Hydro, Inc.</p></li>
<li><p>Haida Energy, Inc.</p></li>
<li><p>Alaska Environmental Power, LLC</p></li>
<li><p>Alaska Electric Generation &amp; Transmission Cooperative, Inc</p></li>
<li><p>Aurora Energy, LLC</p></li>
<li><p>Aleutian Wind Energy, LLC</p></li>
<li><p>Kwaan Electric Transmission Intertie Cooperative, Inc.</p></li>
</ul>
<p>The following certificates are not included in the dataset because they are inactive, despite being incorrectly categorized as active on the RCA website.</p>
<ul>
<li><p>Weldon S. Holmes, d/b/a Semloh Supply</p></li>
<li><p>Weisner Trading Co.</p></li>
<li><p>Paxson Lodge</p></li>
<li><p>Anchorage ML&amp;P (acquired by CEA)</p></li>
<li><p>Alaska Industrial Development &amp; Export Authority - Healy (Revoked in 2019, AIDEA sold the Healy project in 2014)</p></li>
</ul>
</section>
</section>
<section id="other-fixes" class="level2">
<h2 class="anchored" data-anchor-id="other-fixes">Other fixes</h2>
<p>When a utility’s service area was missing (because there was no KML available on the RCA site) or incorrect, corrected service areas were created by hardcoding the correct Public Land Survey System (PLSS) descriptions when possible. Using the Alaska Department of Natural Resources’ <a href="https://data-soa-dnr.opendata.arcgis.com/datasets/SOA-DNR::plss-sections-unclipped/about">PLSS sections dataset</a>, the script then retrieved the appropriate polygons for those descriptions.</p>
<p>The table below lists utilities whose service areas were manually corrected using this method, along with the reason for the correction and a link to the related issue or pull request.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Certificate</th>
<th>Issue</th>
<th>Reference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>City of Akiak</td>
<td>Typo in certificate service area description</td>
<td><a href="https://github.com/acep-uaf/utility-service-areas/issues/11" class="uri">https://github.com/acep-uaf/utility-service-areas/issues/11</a></td>
</tr>
<tr class="even">
<td>Akiachak</td>
<td>Typo in certificate service area description</td>
<td><a href="https://github.com/acep-uaf/utility-service-areas/issues/12" class="uri">https://github.com/acep-uaf/utility-service-areas/issues/12</a></td>
</tr>
<tr class="odd">
<td>Chefornak</td>
<td>Typo in certificate service area description</td>
<td><a href="https://github.com/acep-uaf/utility-service-areas/issues/16" class="uri">https://github.com/acep-uaf/utility-service-areas/issues/16</a></td>
</tr>
<tr class="even">
<td>Puvurnaq Power Company</td>
<td>Typo in certificate service area description</td>
<td><a href="https://github.com/acep-uaf/utility-service-areas/issues/47" class="uri">https://github.com/acep-uaf/utility-service-areas/issues/47</a></td>
</tr>
<tr class="odd">
<td>Unalakleet Valley Electric Cooperative</td>
<td>No KML available from RCA site</td>
<td><a href="https://github.com/acep-uaf/utility-service-areas/pull/45" class="uri">https://github.com/acep-uaf/utility-service-areas/pull/45</a></td>
</tr>
<tr class="even">
<td>Birch Creek Tribal Council</td>
<td>No KML available from RCA site</td>
<td><a href="https://github.com/acep-uaf/utility-service-areas/pull/46" class="uri">https://github.com/acep-uaf/utility-service-areas/pull/46</a></td>
</tr>
</tbody>
</table>
<p>Some of the service area KML files available on the RCA website are outdated, since RCA no longer maintains them. This creates issues when a utility expands its service area by acquiring another utility. In these cases, the acquiring utility’s service area should include both its original territory and the territory of the acquired utility.</p>
<p>This problem is especially relevant for the Alaska Village Electric Cooperative (AVEC), which has acquired numerous small utilities over the last decade and now serves 59 discontinuous communities across Alaska. Although AVEC’s official KML does not reflect many of these acquisitions, the acquired utilities’ KML files are still available. By merging those KMLs into AVEC’s service area, the script reconstructs a more accurate representation of AVEC’s current service area.</p>
<p>The table below lists utilities that were manually merged into acquiring utilities for this reason.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Acquiring utility</th>
<th>Acquired utility</th>
<th>Reference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AVEC</td>
<td>Teller Power Company</td>
<td><a href="https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=6e731ed9-5898-4eaa-814c-8d1547ddac1a" class="uri">https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=6e731ed9-5898-4eaa-814c-8d1547ddac1a</a></td>
</tr>
<tr class="even">
<td>AVEC</td>
<td>City of Kotlik</td>
<td><a href="https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=598DFC13-86CF-47A0-A1A3-09245D482BA9" class="uri">https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=598DFC13-86CF-47A0-A1A3-09245D482BA9</a></td>
</tr>
<tr class="odd">
<td>AVEC</td>
<td>City of Ekwok</td>
<td><a href="https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=8c915917-efe4-41ca-8d7d-1cb7534b19a9" class="uri">https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=8c915917-efe4-41ca-8d7d-1cb7534b19a9</a></td>
</tr>
<tr class="even">
<td>AVEC</td>
<td>City of Kobuk</td>
<td><a href="https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=2f3dee1f-e202-434b-8f0a-714714ca3682" class="uri">https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=2f3dee1f-e202-434b-8f0a-714714ca3682</a></td>
</tr>
<tr class="odd">
<td>AVEC</td>
<td>Bethel Utilities Corporation</td>
<td><a href="https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=6eeb6425-ce1f-4c2f-b765-dfd3505e299f" class="uri">https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=6eeb6425-ce1f-4c2f-b765-dfd3505e299f</a></td>
</tr>
<tr class="even">
<td>AVEC</td>
<td>Twin Hills</td>
<td><a href="https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=677d0f01-25b2-4c01-bf9b-bea7358300f9" class="uri">https://rca.alaska.gov/RCAWeb/ViewFile.aspx?id=677d0f01-25b2-4c01-bf9b-bea7358300f9</a></td>
</tr>
<tr class="odd">
<td>CEA</td>
<td>ML&amp;P</td>
<td><a href="https://github.com/acep-uaf/utility-service-areas/issues/9#issuecomment-3054393380" class="uri">https://github.com/acep-uaf/utility-service-areas/issues/9#issuecomment-3054393380</a></td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/acep-uaf\.github\.io\/utility-service-areas\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>